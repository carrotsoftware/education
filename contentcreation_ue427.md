# **Как подготовить ассеты на Unreal Engine 4.27 для Carrot**

> В этом разделе на примерах вы узнаете, как создавать ассеты, готовые для работы с Carrot.
<br>Процессы моделлирования, текстурирования и т.д. затрагиваться не будут.
<br>
<br>В раздел входит: 
<br>1. Структура папок и нейминг ассетов внутри Content Browser.
<br>1.1. Структура папок
<br>1.2. Нейминг ассетов
<br>1.2.1 Нейминг материалов
<br>1.2.2 Нейминг текстур
<br>2. Иерархия элементов внутри World Outliner.
<br>3. Разделение объектов на слои для удобной работы через Layers.
<br>4. Создание и настройка управляющей логики под наш плейлист.

## **1. Структура папок и нейминг ассетов внутри Content Browser. Как правильно это делать.**

Пример, нам прислали следующие подводки:

1. На подводку к сюжету про сахар ставим свеклоуборочный комбайн, позади него гора сахара, которую он образно произвел. Сыпать из комбайна на гору сахар не нужно, но у него что-то должно двигаться, работать.

2. На подводку к сюжету о логистике нужен корабль контейнеровоз и кран, загружающий/разгружающий контейнер. Можно попробовать налить воды ниже уровня сцены, но только если она будет реалистичной.

3. Великая Европейская стена. Типа отделяет Запад от России. Стена наподобие китайской. Идет из экрана ( из за горизонта ) - слева от таблетки. Извилистая. Перед таблеткой как бы ворота в стене. Перед ней стоит фура , современная. Типа не может попасть на запад.

4. Тема про жилье. Слева от таблетки строительный кран, со стрелой над таблеткой, кран поднимает плиту. Справа от таблетки строящийся дом( еще недостроен до крыши) Кран работает, плиту переносит на дом. В какой то момент плита зависает на таблеткой - типа стройка остановилась. Надо еще небо. А по периметру над декорациями высятся готовые высотки, целый город

Мы выбрали подводку к сюжету про сахарную гору и комбайн с определенным действием по кнопке для AR проекта. С чего начать?

<br>

### **1.1. Структура папок**
У каждого ассета должна быть своя папка, желательно с порядковым номером и написанием капсом. Это очень ***круто*** и ***удобно***.

По имени и нумерации найти папку со всем необходимым проще, чем метаться между **всем** контентом, не правда ли? А ведь ещё это можете быть не вы, а инженер на мероприятии, которому погружаться в особенности вашего творческого беспорядка будет некогда.

Лучше всего это сделать сразу, т.к. потом в процессе переименовывания/перетаскивания у ассетов могут слететь ссылки на меши/материалы/текстуры, либо анрил просто сложится.

В `Content Browser`, внутри `Content` создаём папку с названием содержимого. Это может быть название подводки, сюжета или главного объекта. В нашем случае это `01_SUGAR`, нумерация соответствует нумерации списка от заказчика со всеми подводками к выпуску:

![Simple Folder Structure](images/contentcreation_ue427/folderstructure_01.png)

В созданной папке `01_SUGAR` создаем следующие подпапки по мере надобности:
 
Название папки | Описание
-|-
**Animations** | Анимации для Skeletal Mesh, алембики, секвенцеры и т.д.
**Blueprints** | Управляющие блупринты, префабы объектов, Material Parameter Collection и всё остальное, что связано с логикой.
**FX** | Эффекты Niagara и Cascade
**Levels** | Уровни с объектами
**Materials** | -
**Mesh** | Сюда кидаем наши импортнутые FBX, OBJ и т.д.
**Textures** | -

<br>Если объектов внутри одной подводки несколько, то сначала надо создать папку с именем объекта, а внутри неё уже устраивать наполнение по умолчанию. У нас эта структура будет иметь следующий вид:

![Advanced Folder Structure](images/contentcreation_ue427/folderstructure_02.png)

Название папки | Описание
-|-
`01_SUGAR` | Название папки с подводкой
`01_Harvester` | Папка со всем содержимым для свеклоуборочного комбайна
`02_Sugarpile` | Папка со всем содержимым для горы сахара

>## В примере выше объекты не имеют отдельных уровней под комбайн и гору, т.к. объекты простые, поэтому они собраны вместе на одном, поэтому папка `_Levels` находится в корне папки `01_SUGAR` и визуально выделена нижним подчеркиванием.
<br>

### **1.2. Нейминг ассетов**
#### **1.2.1 Нейминг материалов**

Материалы называем также как и ассет, если требуется разбить на несколько материалов, то пишем `M_` + `название ассета` + `_название детали или группы деталей`. Если используем мастер материалы, то пишем `MM_` + `название ассета`, а инстансы подписываем `MI_` + `название ассета` + `_название детали или группы деталей`.

>## Кому интересны все рекомендованные префиксы ассетов - [ссылка на док](https://docs.unrealengine.com/4.27/en-US/ProductionPipelines/AssetNaming/).

<br>**Пример:**
    
    M_Harvester_glass
    M_Harvester_wheels
    M_Harvester_chassis
    M_Harvester_gum
    M_Harvester_plastic
    MM_Harvester
    MI_Harvester_wheels
<br>

#### **1.2.2 Нейминг текстур**

Текстуры называем по той же логике что и все остальное: `T_название ассета_суффикс`.

>## **T** for **ТЕКСТУРА**
<br>

Тип текстуры | Суффикс
-|-
**Base color** | _D
**Metallic** | _M
**Specular** | _S
**Roughness** | _R
**Normal** | _N
**Displacement** | _DP
**Ambient Occlusion** | _AO
**Height Map** | _H
**Flow Map** | _FM
**Light Map (fake)** | _L
**Mask** | _MA

<br>

**Пример:**
    
    T_Harvester_D
    T_Harvester_M
    и.т.д.

## **2. Иерархия элементов внутри World Outliner. Как надо, чтобы инженеры зауважали.**

Первым делом мы создаём новый уровень, в который будем накидывать объекты и настраивать, по первому времени, ассеты. Называем его по имени основного объекта, либо подводки под которую ассеты создаются без префиксов: `название`. Если уровень составной или имеет несколько итераций, то пишем `название` + `_назначение` + `_порядкой номер`. Если над проектом пыхтят несколько трудяг одновременно, то каждый создаёт себе новый уровень с обозначением того, что на этом уровне делалось.

<br>

**Пример:**
    
    01_SUGAR
    01_SUGAR_lighting
    01_SUGAR_lighting_02
    01_SUGAR_02_environment_03
    и.т.д.
>## Составные уровни в 99% случаев используются при создании глобальных сцен (студии, пустыни, города, поля) под VR проект на зелёнке. Отдельно освещение, отдельно объекты ближнего плана, дальнего плана, ключевые объекты и т.д.<br><br>В AR проектах такая реализация используется меньше. Если ассет делали несколько людей, то финальный результат должен быть в одном уровне.
<br>

Открываем уровень, кидаем объекты, развлекаемся. В процессе творения получилось что-то такое:
<br>

![Asset Viewport Preview](images/contentcreation_ue427/viewport_01.png)

<br>

Cтруктура папок создана, текстуры и анимации раскиданы по папкам, материалы накручены, блупринты накожены, свет выставлен. **Что дальше?**

После всех наших первичных манипуляций иерархия уровня, скорее всего, будет выглядеть так:

![Outliner hierarchy unsorted](images/contentcreation_ue427/outliner_hierarchy_unsorted.png)

>## В данном примере мы выбрали реализацию через упаковку геометрии с анимацией и логикой напрямую в **Actor Blueprint** (ещё называют Prefab) `BP_Harvester` и `BP_SugarPile`. Зачем и почему, как сделать и какие ещё виды реализации существуют читаем [здесь](TODO).
<br>

В итоге получается полная каша и неразбериха. Как создатель вы, возможно, и сможете ориентироваться в подобном, но любой другой после вас **вряд ли**. 

Нам нужно сделать так, чтобы эти объекты было легко найти среди остального контента `World Outliner` собранного на эфир проекте, мы могли перетаскивать, крутить и масштабировать объекты, причем чтобы мы могли двигать объект как вместе со всем освещением, так и отдельно от него, не ломая выполнение логики в **Actor Blueprint**.

На выходе мы должны получить следующую иерархию:

![Outliner hierarchy sorted](images/contentcreation_ue427/outliner_hierarchy_sorted.png)

<br>

Почему такую? **Разбираемся**:

📁 - папка, в которой мы храним все объекты сцены. Когда на уровне будет 10-20 разных ассетов и нужно будет быстро переключаться между ними, папки - ваше спасение.
🔵 - Empty Actor, к которому привязаны все, что относится к объекту. За него можно быстро перетащить всю структуру вместе со светом и ничего не потерять.
🟢 - Empty Actor,
🔴 - Blueprint с нашим объектом. Перетаскивать его напрямую в сессии мультиюзера крайне не рекомендуется, т.к. высока вероятность, что выполнение логики остановится.
💡 - Разные источники света, крутятся вместе с 🔵 null


# TODO
- [] Проверяем Pivot в блупринте
- [] Виды реализации контента для Carrot. Разница, преимущества и недостатки.
- [] Sort Transnlucency